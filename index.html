<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Happy Valentine‚Äôs üíò</title>
  <style>
    :root{
      /* --bg1:#ff4d6d; */
      --bg1:#dbdbdb;
      --bg2:#7b2cbf;
      --card: rgba(255,255,255,0.14);
      --card2: rgba(255,255,255,0.10);
      --text:#fff;
      --shadow: 0 20px 60px rgba(0,0,0,0.25);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      min-height: 100vh;
      background: radial-gradient(circle at 20% 10%, #ffccd5 0%, transparent 30%),
                  radial-gradient(circle at 80% 20%, #ffd6ff 0%, transparent 30%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* ===== Verification mode: plain white, standard look ===== */
    body.verify-mode{
      --text:#111;
      background:#fff !important;
    }
    body.verify-mode .hearts{ display:none; }
    body.verify-mode header,
    body.verify-mode footer{ display:none; }
    body.verify-mode .wrap{
      padding: 0;
      background:#fff;
    }
    body.verify-mode .card{
      width: 100%;
      max-width: 520px;
      margin: 0 auto;
      background:#fff;
      border: 1px solid #e8e8e8;
      border-radius: 14px;
      box-shadow: 0 16px 50px rgba(0,0,0,0.10);
      backdrop-filter: none;
    }
    body.verify-mode main{
      padding: 22px 18px 18px;
    }

    /* ===== Full-page backgrounds for Gallery + Question (NOT the card) ===== */
    body.bg-gallery{
      background:
        radial-gradient(circle at 20% 10%, rgba(255,255,255,.18) 0%, transparent 32%),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,.14) 0%, transparent 34%),
        linear-gradient(135deg, rgba(2, 97, 54, 0.98), rgba(212,175,55,.96)) !important;
    }
    body.bg-question{
      background:
        radial-gradient(circle at 20% 10%, rgba(255,255,255,.18) 0%, transparent 32%),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,.14) 0%, transparent 34%),
        linear-gradient(135deg, rgba(255, 160, 190, .98), rgba(255, 105, 160, .96)) !important;
    }

    /* Floating hearts background */
    .hearts{
      position: fixed;
      inset: 0;
      pointer-events:none;
      overflow:hidden;
      z-index:0;
    }
    .heart{
      position:absolute;
      width: 18px;
      height: 18px;
      transform: rotate(45deg);
      opacity: .8;
      animation: floatUp linear forwards;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.2));
    }
    .heart:before, .heart:after{
      content:"";
      position:absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
    }

    .heart:before{ left:-50%; top:0; }
    .heart:after{ left:0; top:-50%; }


    @keyframes floatUp{
      from{ transform: translateY(30vh) rotate(45deg) scale(.9); }
      to{ transform: translateY(-120vh) rotate(45deg) scale(1.3); }
    }

    /* Layout */
    .wrap{
      position:relative;
      z-index:1;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px;
    }
    .card{
      width:min(980px, 100%);
      background: linear-gradient(180deg, var(--card), var(--card2));
      backdrop-filter: blur(14px);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 26px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 18px 18px 0 18px;
      gap: 12px;
    }
    .dots{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: rgba(255,255,255,.35);
    }
    .dot.active{ background: rgba(255,255,255,.9); }

    .nav{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .pill{
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.12);
      color:#fff;
      padding:10px 14px;
      border-radius: 999px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease, opacity .12s ease;
      font-weight: 600;
      font-size: 14px;
    }
    .pill:hover{ transform: translateY(-1px); background: rgba(255,255,255,.18); }
    .pill:active{ transform: translateY(0px); }
    .pill[disabled]{
      opacity:.45;
      cursor:not-allowed;
      transform:none;
    }
    .pill[disabled]:hover{ transform:none; background: rgba(255,255,255,.12); }

    .status-badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.12);
      font-weight: 800;
      font-size: 13px;
      letter-spacing: .01em;
      white-space:nowrap;
    }
    .status-dot{
      width:8px;
      height:8px;
      border-radius:50%;
      background: rgba(255,255,255,.55);
    }
    .status-dot.ok{ background: rgba(255,255,255,.92); }

    main{
      padding: 18px;
    }

    .page{
      display:none;
      animation: pop .35s ease both;
    }
    .page.active{ display:block; }
    @keyframes pop{
      from{ opacity:0; transform: translateY(10px) scale(.98); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    /* Intro */
    .hero{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
      align-items:center;
    }
    @media (max-width: 780px){
      .hero{ grid-template-columns: 1fr; }
    }
    h1{
      margin: 6px 0 8px;
      font-size: clamp(28px, 4vw, 44px);
      letter-spacing: -0.02em;
    }
    .subtitle{
      margin:0;
      opacity:.95;
      font-size: clamp(14px, 2.2vw, 18px);
      line-height:1.5;
    }
    .type{
      margin-top: 14px;
      padding: 14px 14px;
      border-radius: 18px;
      background: rgba(0,0,0,0.14);
      border: 1px solid rgba(255,255,255,0.15);
      font-size: 16px;
      min-height: 58px;
      white-space: pre-wrap;
    }
    .big-emoji{
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10);
      min-height: 220px;
      position:relative;
      overflow:hidden;
    }
    .big-emoji span{
      font-size: 86px;
      filter: drop-shadow(0 18px 18px rgba(0,0,0,.25));
      animation: bob 1.8s ease-in-out infinite;
    }
    @keyframes bob{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-10px); }
    }

    .cta-row{
      display:flex;
      gap:12px;
      margin-top: 14px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      border: none;
      cursor:pointer;
      padding: 12px 16px;
      border-radius: 16px;
      font-weight: 800;
      color: #2b0a3d;
      background: #fff;
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }
    .btn.secondary{
      color:#fff;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.25);
      box-shadow:none;
    }
    .btn[disabled]{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
    }

    /* Gallery */
    .gallery-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .gallery-grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    @media (max-width: 920px){ .gallery-grid{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 650px){ .gallery-grid{ grid-template-columns: repeat(2, 1fr); } }

    .tile{
      position:relative;
      border-radius: 18px;
      overflow:hidden;
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,0.18);
      aspect-ratio: 1 / 1;
      transition: transform .12s ease;
    }
    .tile:hover{ transform: translateY(-2px) scale(1.01); }
    .tile img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter: saturate(1.1);
      transform: scale(1.02);
    }
    .tile:after{
      content:"‚ú®";
      position:absolute;
      right:10px; top:10px;
      opacity:0;
      transform: translateY(-6px);
      transition: opacity .15s ease, transform .15s ease;
      text-shadow: 0 10px 18px rgba(0,0,0,.35);
    }
    .tile:hover:after{
      opacity:1;
      transform: translateY(0);
    }

    /* Lightbox */
    .lightbox{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 999;
    }
    .lightbox.active{ display:flex; }
    .lightbox-inner{
      width:min(980px, 100%);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 22px;
      backdrop-filter: blur(14px);
      padding: 14px;
      box-shadow: var(--shadow);
      position:relative;
    }
    .lightbox img{
      width:100%;
      max-height: 74vh;
      object-fit: contain;
      border-radius: 16px;
      background: rgba(0,0,0,.25);
    }
    .x{
      position:absolute;
      right: 12px;
      top: 12px;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.12);
      color:#fff;
      font-size: 18px;
      cursor:pointer;
    }

    /* Valentine page */
    .question{
      text-align:center;
      padding: 20px 10px 8px;
    }
    .question h2{
      margin: 0 0 8px;
      font-size: clamp(26px, 3.4vw, 40px);
    }
    .question p{
      margin: 0 0 18px;
      opacity:.95;
    }

    .arena{
      margin-top: 16px;
      position:relative;
      height: 260px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.14);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap: 12px;
    }
    .choice-row{
      display:flex;
      gap: 12px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }
    .btn.yes{
      background: #fff;
    }
    .btn.no{
      position:absolute;
      left: 58%;
      top: 55%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.25);
      color:#fff;
      box-shadow:none;
    }

    .message{
      margin-top: 10px;
      font-weight: 700;
      font-size: 18px;
      min-height: 24px;
    }

    /* Confetti */
    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 9999;
      display:none;
    }
    .confetti.active{ display:block; }
    .confetti span{
      position:absolute;
      top:-10px;
      width: 10px;
      height: 14px;
      opacity: .95;
      animation: confettiFall linear forwards;
      border-radius: 2px;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.25));
    }
    @keyframes confettiFall{
      to{ transform: translateY(110vh) rotate(720deg); }
    }

    footer{
      padding: 0 18px 18px;
      opacity: .85;
      font-size: 13px;
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:10px;
    }
    .tiny{
      opacity:.9;
    }

    a{ color:#fff; }

    /* ====== "STANDARD" VERIFICATION PAGE (3x3 grid) ====== */
    .verify-wrap{
      display:grid;
      gap: 14px;
      align-items:center;
    }
    .verify-top{
      text-align:center;
      padding: 6px 6px 0;
    }
    .verify-top h1{
      margin: 0 0 6px;
      font-size: 24px;
      letter-spacing:-0.01em;
      color:#111;
    }
    .verify-top p{
      margin: 0;
      color:#444;
      line-height:1.45;
      font-size: 14px;
    }

    .verify-panel{
      margin-top: 6px;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid #e7e7e7;
      background: #fafafa;
    }
    .verify-head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .verify-prompt{
      font-weight: 800;
      font-size: 13px;
      color:#222;
      line-height:1.35;
    }
    .verify-hint{
      margin-top: 6px;
      color:#666;
      font-size: 12px;
      line-height:1.4;
    }
    .verify-count{
      font-weight: 800;
      font-size: 12px;
      color:#333;
      background:#fff;
      border: 1px solid #e6e6e6;
      padding: 8px 10px;
      border-radius: 999px;
      white-space:nowrap;
    }

    .captcha-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      width: min(320px, 100%);
      margin: 0 auto;
    }

    .captcha-tile{
      position:relative;
      border-radius: 6px;
      overflow:hidden;
      border: 1px solid #e0e0e0;
      background: #fff;
      aspect-ratio: 1 / 1;
      cursor:pointer;
      transition: transform .08s ease;
    }
    .captcha-tile:hover{ transform: translateY(-1px); }
    .captcha-tile img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      user-select:none;
      -webkit-user-drag:none;
      transform: scale(1.02);
      filter: saturate(1.05);
    }
    .captcha-tile.selected{
      outline: 3px solid rgba(40, 120, 255, .9);
      outline-offset: -3px;
    }
    .captcha-tile.selected:after{
      content:"‚úì";
      position:absolute;
      right:6px; top:6px;
      width: 20px; height: 20px;
      border-radius: 6px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(40, 120, 255, .95);
      color:#fff;
      font-weight: 900;
      font-size: 13px;
    }

    .captcha-actions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      justify-content:center;
      margin-top: 12px;
    }
    body.verify-mode .btn{
      background:#111;
      color:#fff;
      box-shadow:none;
      border-radius: 10px;
      padding: 10px 14px;
    }
    body.verify-mode .btn.secondary{
      background:#fff;
      color:#111;
      border: 1px solid #e3e3e3;
    }

    .captcha-msg{
      text-align:center;
      min-height: 22px;
      font-weight: 800;
      margin-top: 10px;
      letter-spacing:-0.01em;
      color:#333;
      font-size: 13px;
    }
    .captcha-msg.ok{ color:#118a3b; }
    .captcha-msg.err{ color:#b42318; }

    /* Verification success overlay animation */
    .verify-overlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 10000;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(6px);
    }
    .verify-overlay.active{ display:flex; }
    .verify-badge{
      width: min(360px, 90vw);
      border: 1px solid #e7e7e7;
      background: #fff;
      border-radius: 16px;
      padding: 18px 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.12);
      text-align:center;
      animation: verifyPop .35s ease both;
    }
    @keyframes verifyPop{
      from{ opacity:0; transform: translateY(12px) scale(.98); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    .check{
      width: 54px;
      height: 54px;
      border-radius: 16px;
      margin: 0 auto 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: #118a3b;
      color:#fff;
      font-weight: 1000;
      font-size: 28px;
      animation: checkPulse .55s ease-in-out both;
    }
    @keyframes checkPulse{
      0%{ transform: scale(.88); }
      60%{ transform: scale(1.05); }
      100%{ transform: scale(1); }
    }
    .verify-badge h3{
      margin: 0 0 6px;
      color:#111;
      font-size: 16px;
      letter-spacing:-0.01em;
    }
    .verify-badge p{
      margin:0;
      color:#555;
      font-size: 13px;
      line-height:1.35;
    }
  </style>
</head>

<body>
  <div class="hearts" id="hearts"></div>
  <div class="confetti" id="confetti"></div>

  <!-- Verification success overlay -->
  <div class="verify-overlay" id="verifyOverlay" aria-hidden="true">
    <div class="verify-badge">
      <div class="check">‚úì</div>
      <h3>Verification complete</h3>
      <p>Welcome üíó</p>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <header>
        <div class="dots" aria-label="progress">
          <div class="dot" id="dot1"></div>
          <div class="dot" id="dot2"></div>
          <div class="dot" id="dot3"></div>
        </div>

        <div class="nav">
          <span class="status-badge" id="lockBadge" aria-live="polite">
            <span class="status-dot" id="lockDot"></span>
            <span id="lockText">Locked</span>
          </span>

          <button class="pill" data-go="1">Intro</button>
          <button class="pill" data-go="2">Gallery</button>
          <button class="pill" data-go="3">Question</button>
        </div>
      </header>

      <main>
        <!-- PAGE 0: VERIFICATION (standard-style) -->
        <section class="page" id="page0">
          <div class="verify-wrap">
            <div class="verify-top">
              <h1>Verification</h1>
              <p>
                Select the images that match the prompt to continue.
              </p>
            </div>

            <div class="verify-panel">
              <div class="verify-head">
                <div>
                  <div class="verify-prompt" id="captchaPrompt">
                    Select these 3 images:
                    <span id="captchaTarget">Diesel üê∂, the football game üèà, and the digital camera üì∑</span>
                  </div>
                  <div class="verify-hint">
                    Click to select/unselect. Then press <b>Verify</b>. You must select <b>exactly 3</b>.
                  </div>
                </div>

                <div class="verify-count" id="captchaSelectCount">Selected 0</div>
              </div>

              <div class="captcha-grid" id="captchaGrid" aria-label="image challenge"></div>

              <div class="captcha-actions">
                <button class="btn secondary" id="clearSelection">Clear</button>
                <button class="btn" id="verifyCaptcha">Verify</button>
              </div>

              <div class="captcha-msg" id="captchaMsg" aria-live="polite"></div>
            </div>
          </div>
        </section>

        <!-- PAGE 1: INTRO -->
        <section class="page" id="page1">
          <div class="hero">
            <div>
              <h1 id="title">Hiiii üíñ</h1>
              <!-- <p class="subtitle">Here's a website I made for you...</p> -->

              <div class="type" id="typebox" aria-live="polite"></div>

              <div class="cta-row">
                <button class="btn" id="toGallery">Next ‚Üí</button>
                <button class="btn secondary" id="surprise">Tap Here ‚ú®</button>
              </div>

              <p class="tiny" style="margin-top:12px; opacity:.9;">
                <!-- Tip: Replace the text + images with yours, and this becomes *your* story. -->
              </p>
            </div>

            <div class="big-emoji">
              <span id="emoji">üíò</span>
            </div>
          </div>
        </section>

        <!-- PAGE 2: GALLERY -->
        <section class="page" id="page2">
          <div class="gallery-head">
            <div>
              <h1 style="margin:0 0 6px;">Our Moments üì∏</h1>
              <p class="subtitle" style="margin:0;">Click on each picture! (We really need to take more pictures)</p>
            </div>
            <button class="btn" id="toQuestion">Next ‚Üí </button>
          </div>

          <div class="gallery-grid" id="gallery">
            <!-- Replace these with your real images in /images -->
            <!-- data-tags used by the verification gate -->
            <div class="tile"><img src="images/1.jpg" alt="Us 1" data-message="Always looking fab!" data-tags="none"></div>
            <div class="tile"><img src="images/2.jpg" alt="Us 2" data-message="Your first real football experience." data-tags="football"></div>
            <div class="tile"><img src="images/3.jpg" alt="Us 3" data-message="Always trying to be me!!" data-tags="none"></div>
            <div class="tile"><img src="images/4.jpg" alt="Us 4" data-message="Diesel said he likes me more..." data-tags="diesel"></div>
            <div class="tile"><img src="images/5.jpg" alt="Us 5" data-message="I'm excited to try more wine!" data-tags="none"></div>
            <div class="tile"><img src="images/6.jpg" alt="Us 6" data-message="The sports bar experience!" data-tags="none"></div>
            <div class="tile"><img src="images/7.jpg" alt="Us 7" data-message="We should try more new restraunts!" data-tags="none"></div>
            <div class="tile"><img src="images/8.jpg" alt="Us 8" data-message="Bring back the digital camera!" data-tags="camera"></div>
          </div>
        </section>

        <!-- PAGE 3: THE QUESTION -->
        <section class="page" id="page3">
          <div class="question">
            <h2>Will you be my Valentine? üíù</h2>
            <p>Choose wisely!</p>

            <div class="arena" id="arena">
              <div class="choice-row">
                <button class="btn yes" id="yesBtn">YES üòç</button>
              </div>

              <button class="btn no" id="noBtn">No üôà</button>

              <div class="message" id="msg"></div>
            </div>

            <div class="cta-row" style="justify-content:center; margin-top:16px;">
              <button class="btn secondary" id="backToGallery">‚Üê Back to Gallery</button>
              <button class="btn" id="restart">Restart ‚ú®</button>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <div>Made with üíó by <span id="by">Kyle Dorito</span></div>
        <div class="tiny">GitHub Pages ready ‚Ä¢ no frameworks</div>
      </footer>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox-inner">
      <button class="x" id="closeLb" aria-label="Close">‚úï</button>
      <h3 id="lbCaption" style="margin:0 0 10px; text-align:center;"></h3>
      <img id="lbImg" src="" alt="Expanded photo">
    </div>
  </div>

  <script>
    // ====== SIMPLE "PAGES" NAV (with verification gate) ======
    const pages = [
      document.getElementById('page0'),
      document.getElementById('page1'),
      document.getElementById('page2'),
      document.getElementById('page3')
    ];
    const dots = [
      document.getElementById('dot1'),
      document.getElementById('dot2'),
      document.getElementById('dot3')
    ];

    const navPills = document.querySelectorAll('[data-go]');
    const lockText = document.getElementById('lockText');
    const lockDot = document.getElementById('lockDot');

    let unlocked = false;

    function setNavLocked(isLocked){
      navPills.forEach(btn=>{
        btn.disabled = isLocked;
        btn.setAttribute('aria-disabled', isLocked ? 'true' : 'false');
      });
      lockText.textContent = isLocked ? "Locked" : "Unlocked";
      lockDot.classList.toggle('ok', !isLocked);
    }

    function setBodyBgClassForPage(n){
      document.body.classList.remove('bg-gallery','bg-question');
      if(n === 2) document.body.classList.add('bg-gallery');
      if(n === 3) document.body.classList.add('bg-question');
    }

    function goPage(n){
      // n: 0..3 where 0 is verification
      if(!unlocked && n !== 0) n = 0;

      // Toggle verification mode styles (plain white)
      document.body.classList.toggle('verify-mode', n === 0);

      // Full background theme for Gallery/Question
      if(n !== 0){
        setBodyBgClassForPage(n);
      } else {
        document.body.classList.remove('bg-gallery','bg-question');
      }

      for(let i=0;i<=3;i++){
        pages[i].classList.toggle('active', i===n);
      }

      // dots represent pages 1..3 only
      for(let i=0;i<3;i++){
        const pageIndex = i + 1; // 1..3
        dots[i].classList.toggle('active', pageIndex === n);
      }

      // No hearts on the verification page
      if(n !== 0) burstHearts(8);

      window.scrollTo({top:0, behavior:"smooth"});
    }

    navPills.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        goPage(Number(btn.dataset.go));
      });
    });

    document.getElementById('toGallery').addEventListener('click', ()=> goPage(2));
    document.getElementById('toQuestion').addEventListener('click', ()=> goPage(3));
    document.getElementById('backToGallery').addEventListener('click', ()=> goPage(2));
    document.getElementById('restart').addEventListener('click', ()=> {
      document.getElementById('msg').textContent = "";
      goPage(1);
      typeStart();
    });

    // Start locked on verification page
    setNavLocked(true);
    goPage(0);

    // ====== TYPEWRITER INTRO ======
    const typebox = document.getElementById('typebox');
    const lines = [
      "Hiii üòå",
      "I wanted to do something small but memorable.",
      "So here‚Äôs a website I made for you üíò"
    ];
    let typingTimer;

    function typeStart(){
      clearTimeout(typingTimer);
      typebox.textContent = "";
      let lineIndex = 0, charIndex = 0;

      function tick(){
        const current = lines[lineIndex];
        typebox.textContent = current.slice(0, charIndex);

        if(charIndex < current.length){
          charIndex++;
          typingTimer = setTimeout(tick, 22 + Math.random()*25);
        } else {
          // pause then next line
          lineIndex++;
          if(lineIndex < lines.length){
            charIndex = 0;
            typingTimer = setTimeout(()=>{ typebox.textContent += "\n"; tick(); }, 450);
          }
        }
      }
      tick();
    }

    // Surprise button: rotates emoji + mini confetti
    const emoji = document.getElementById('emoji');
    const surprise = document.getElementById('surprise');
    const emojiList = ["üíò","üíù","üíñ","üíï","üòç","ü•∞","üåπ","üçì","‚ú®"];
    surprise.addEventListener('click', ()=>{
      emoji.textContent = emojiList[Math.floor(Math.random()*emojiList.length)];
      burstHearts(12);
      // confettiBlast(80);
    });

    // ====== FLOATING HEARTS BACKGROUND (spread out) ======
    const hearts = document.getElementById('hearts');

    // Use "lanes" so hearts aren't clustering together horizontally
    const HEART_LANES = 12;
    let heartLaneIndex = 0;

    function laneLeft(lanes, idx, jitterPct){
      const laneW = 100 / lanes;
      const base = (idx % lanes) * laneW + laneW / 2;
      const jitter = (Math.random() - 0.5) * (laneW * jitterPct);
      return Math.max(0, Math.min(100, base + jitter));
    }

    function spawnHeart(){
      const h = document.createElement('div');
      h.className = 'heart';

      const left = laneLeft(HEART_LANES, heartLaneIndex++, 0.75); // spread across lanes
      const size = 10 + Math.random()*18;
      const duration = 7.5 + Math.random()*6.5; // slightly longer = less "busy"

      // random pink/purple
      const colors = ["#ffb3c1","#ff4d6d","#ffd6ff","#c77dff","#ff758f","#ffa6c1"];
      const color = colors[Math.floor(Math.random()*colors.length)];

      h.style.left = left + "vw";
      h.style.bottom = "-20px";
      h.style.width = size + "px";
      h.style.height = size + "px";
      h.style.background = color;
      h.style.animationDuration = duration + "s";
      h.style.opacity = (0.45 + Math.random()*0.35).toFixed(2); // a bit lighter

      hearts.appendChild(h);
      setTimeout(()=> h.remove(), duration*1000);
    }

    // Fewer hearts per second so it doesn't fight with confetti
    setInterval(spawnHeart, 700);

    function burstHearts(count){
      for(let i=0;i<count;i++){
        setTimeout(spawnHeart, i*85); // slower burst = more spaced out
      }
    }

    // ====== GALLERY LIGHTBOX ======
    const lightbox = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const lbCaption = document.getElementById('lbCaption');
    document.getElementById('closeLb').addEventListener('click', ()=> lightbox.classList.remove('active'));
    lightbox.addEventListener('click', (e)=> {
      if(e.target === lightbox) lightbox.classList.remove('active');
    });

    document.querySelectorAll('.tile img').forEach(img=>{
      img.addEventListener('click', ()=>{
        lbImg.src = img.src;
        lbImg.alt = img.alt || "Photo";
        lbCaption.textContent = img.dataset.message || "";
        lightbox.classList.add('active');
      });
    });

    // ====== RUNAWAY "NO" BUTTON + YES CONFETTI ======
    const noBtn = document.getElementById('noBtn');
    const yesBtn = document.getElementById('yesBtn');
    const arena = document.getElementById('arena');
    const msg = document.getElementById('msg');

    function moveNoButton(){
      const rect = arena.getBoundingClientRect();
      const pad = 16;

      // button size approx
      const bw = 110, bh = 46;

      const x = pad + Math.random()*(rect.width - bw - pad*2);
      const y = pad + Math.random()*(rect.height - bh - pad*2);

      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
      noBtn.style.transform = "translate(0,0)";
    }

    // moves when hovered/touched
    ["mouseenter","touchstart","click"].forEach(evt=>{
      noBtn.addEventListener(evt, (e)=>{
        e.preventDefault();
        moveNoButton();
        msg.textContent = pick([
          "Hehe nope üòÖ",
          "Too slow üòú",
          "Try again ü§≠",
          "Nice try üôà"
        ]);
      }, {passive:false});
    });

    yesBtn.addEventListener('click', ()=>{
      msg.textContent = "YAYYYY!! üíû I love you!!!";
      confettiBlast(160);
      burstHearts(18);
    });

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    // ====== CONFETTI (spread out) ======
    const confetti = document.getElementById('confetti');

    function confettiBlast(count){
      confetti.innerHTML = "";
      confetti.classList.add('active');

      const colors = ["#ffffff","#ffd6ff","#ffccd5","#c77dff","#ff4d6d","#ffe5ec"];

      // Distribute pieces across lanes, then add small jitter
      const LANES = 18;
      const perLane = Math.ceil(count / LANES);

      let made = 0;
      for(let lane=0; lane<LANES; lane++){
        for(let j=0; j<perLane; j++){
          if(made >= count) break;
          made++;

          const piece = document.createElement('span');

          const left = laneLeft(LANES, lane, 0.65); // evenly spread
          const sizeW = 6 + Math.random()*7;
          const sizeH = 8 + Math.random()*12;
          const duration = 3.2 + Math.random()*2.3;

          // Stagger start times so they don't clump into a single wave
          const delay = (Math.random()*0.65) + (j * 0.03);

          piece.style.left = left + "vw";
          piece.style.width = sizeW + "px";
          piece.style.height = sizeH + "px";
          piece.style.background = colors[Math.floor(Math.random()*colors.length)];
          piece.style.animationDuration = duration + "s";
          piece.style.animationDelay = delay + "s";

          confetti.appendChild(piece);
          setTimeout(()=> piece.remove(), (duration + delay + 0.7) * 1000);
        }
      }

      setTimeout(()=> confetti.classList.remove('active'), 4300);
    }

    // ====== PERSONALIZED CAPTCHA (3x3, includes a 9th image: images\6__.jpg) ======
    const captchaGrid = document.getElementById('captchaGrid');
    const captchaMsg = document.getElementById('captchaMsg');
    const captchaSelectCount = document.getElementById('captchaSelectCount');
    const captchaPrompt = document.getElementById('captchaPrompt');
    const captchaTarget = document.getElementById('captchaTarget');
    const clearSelection = document.getElementById('clearSelection');
    const verifyCaptcha = document.getElementById('verifyCaptcha');

    const verifyOverlay = document.getElementById('verifyOverlay');

    // REQUIRED: exactly these 3 tags must be selected (one per image)
    const REQUIRED_KEYS = ["diesel", "football", "camera"];

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function splitTags(tagStr){
      return (tagStr || "")
        .toLowerCase()
        .split(/\s+/)
        .filter(Boolean);
    }

    function galleryItems(){
      const base = Array.from(document.querySelectorAll('#gallery .tile img')).map(img=>{
        return {
          src: img.src,
          alt: img.alt || "Photo",
          tags: splitTags(img.dataset.tags),
          message: img.dataset.message || ""
        };
      });

      // Add the new 9th image specifically requested
      base.push({
        src: "images/IMG_8998.JPG",
        alt: "Us 9",
        tags: splitTags("none"),
        message: ""
      });

      // Ensure we use only 9 items for the 3x3 grid
      return base.slice(0, 9);
    }

    function buildCaptchaGrid(){
      captchaGrid.innerHTML = "";
      const items = shuffle(galleryItems());

      items.forEach(item=>{
        const tile = document.createElement('div');
        tile.className = "captcha-tile";
        tile.dataset.tags = item.tags.join(" ");

        const im = document.createElement('img');
        im.src = item.src;
        im.alt = item.alt;

        tile.appendChild(im);

        tile.addEventListener('click', ()=>{
          tile.classList.toggle('selected');
          captchaMsg.textContent = "";
          captchaMsg.className = "captcha-msg";
          updateSelectedCount();
        });

        captchaGrid.appendChild(tile);
      });

      updateSelectedCount();
    }

    function updateSelectedCount(){
      const selected = captchaGrid.querySelectorAll('.captcha-tile.selected').length;
      captchaSelectCount.textContent = `Selected ${selected}`;
    }

    function tileHasTag(tile, key){
      const tags = splitTags(tile.dataset.tags);
      return tags.includes(key);
    }

    function clearCaptchaSelection(){
      captchaGrid.querySelectorAll('.captcha-tile').forEach(t=> t.classList.remove('selected'));
      updateSelectedCount();
      captchaMsg.textContent = "";
      captchaMsg.className = "captcha-msg";
    }

    function promptText(){
      return "üê∂, üèà, and üì∑";
    }

    // Set prompt text
    captchaTarget.textContent = promptText();
    captchaPrompt.innerHTML = `Select these 3 images that relate to these emojis: <span id="captchaTarget">${promptText()}</span>`;

    // Build grid on load
    buildCaptchaGrid();

    clearSelection.addEventListener('click', ()=>{
      clearCaptchaSelection();
    });

    verifyCaptcha.addEventListener('click', ()=>{
      const tiles = Array.from(captchaGrid.querySelectorAll('.captcha-tile'));
      const selected = tiles.filter(t => t.classList.contains('selected'));

      // Must be exactly 3 selections
      if(selected.length !== 3){
        captchaMsg.textContent = `Select exactly 3 images (you picked ${selected.length}).`;
        captchaMsg.className = "captcha-msg err";
        return;
      }

      // Each selected tile must match at least one required key
      const eachIsValid = selected.every(t => REQUIRED_KEYS.some(k => tileHasTag(t, k)));

      // And collectively they must cover ALL 3 keys (diesel + football + camera)
      const coversAll = REQUIRED_KEYS.every(k => selected.some(t => tileHasTag(t, k)));

      if(eachIsValid && coversAll){
        captchaMsg.textContent = "Verified ‚úì";
        captchaMsg.className = "captcha-msg ok";

        unlocked = true;
        setNavLocked(false);

        // Success animation + then move to Intro
        verifyOverlay.classList.add('active');
        verifyOverlay.setAttribute('aria-hidden', 'false');

        // Fun animation (now more spread out)
        confettiBlast(190);
        burstHearts(16);

        setTimeout(()=>{
          verifyOverlay.classList.remove('active');
          verifyOverlay.setAttribute('aria-hidden', 'true');
          goPage(1);
          typeStart();
        }, 900);
      } else {
        captchaMsg.textContent = "Not quite ‚Äî pick Diesel, the football game, and the digital camera.";
        captchaMsg.className = "captcha-msg err";
      }
    });

    // ====== Optional: Set your name in footer ======
    document.getElementById('by').textContent = "Kyle Dorito"; // Change this to your name!
  </script>
</body>
</html>
